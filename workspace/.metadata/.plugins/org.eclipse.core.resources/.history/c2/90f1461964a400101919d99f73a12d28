package co.com.manager;

import java.sql.*;
import java.util.*;
import co.com.model.Promedio;

public class PromediosManager {

    private Connection con;

    public PromediosManager(Connection con) {
        this.con = con;
    }

    // Listar todos los promedios
    public List<Promedio> getPromedios() throws SQLException {
        List<Promedio> lista = new ArrayList<>();
        String sql = "SELECT * FROM promedios";
        PreparedStatement ps = con.prepareStatement(sql);
        ResultSet rs = ps.executeQuery();

        while (rs.next()) {
            Promedio p = new Promedio(
                rs.getInt("idPromedio"),
                rs.getInt("idEstudiante"),
                rs.getInt("idMateria"),
                rs.getDouble("nota1"),
                rs.getDouble("nota2"),
                rs.getDouble("nota3"),
                rs.getDouble("promedio")
            );
            lista.add(p);
        }
        return lista;
    }

    // Insertar nuevo promedio
    public void insertPromedio(Promedio p) throws SQLException {
        String sql = "INSERT INTO promedios (idEstudiante, idMateria, nota1, nota2, nota3, promedio) VALUES (?, ?, ?, ?, ?, ?)";
        PreparedStatement ps = con.prepareStatement(sql);
        ps.setInt(1, p.getIdEstudiante());
        ps.setInt(2, p.getIdMateria());
        ps.setDouble(3, p.getNota1());
        ps.setDouble(4, p.getNota2());
        ps.setDouble(5, p.getNota3());
        ps.setDouble(6, (p.getNota1() + p.getNota2() + p.getNota3()) / 3); // Calcula promedio autom√°tico
        ps.executeUpdate();
    }

    // Actualizar promedio existente
    public void updatePromedio(Promedio p) throws SQLException {
        String sql = "UPDATE promedios SET idEstudiante=?, idMateria=?, nota1=?, nota2=?, nota3=?, promedio=? WHERE idPromedio=?";
        PreparedStatement ps = con.prepareStatement(sql);
        ps.setInt(1, p.getIdEstudiante());
        ps.setInt(2, p.getIdMateria());
        ps.setDouble(3, p.getNota1());
        ps.setDouble(4, p.getNota2());
        ps.setDouble(5, p.getNota3());
        ps.setDouble(6, (p.getNota1() + p.getNota2() + p.getNota3()) / 3);
        ps.setInt(7, p.getIdPromedio());
        ps.executeUpdate();
    }

    // Eliminar promedio
    public void deletePromedio(int idPromedio) throws SQLException {
        String sql = "DELETE FROM promedios WHERE idPromedio=?";
        PreparedStatement ps = con.prepareStatement(sql);
        ps.setInt(1, idPromedio);
        ps.executeUpdate();
    }
}
